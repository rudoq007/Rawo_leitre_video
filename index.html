
<!DOCTYPE html>
<html>
<head>
    <title>Road Video Sync Map</title>
    <meta charset="utf-8" />
    <style>
        body { margin:0; padding:0; display: flex; height: 100vh; }
        #map { height: 100%; width: 60%; }
        #video { height: 100%; width: 40%; }
        iframe { width: 100%; height: 100%; border: none; }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div id="map"></div>
    <div id="video">
        <iframe id="ytplayer" type="text/html"
          src="https://www.youtube.com/embed/38JummjZeAs?enablejsapi=1"
          frameborder="0" allowfullscreen></iframe>
    </div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://www.youtube.com/iframe_api"></script>
    <script>
        let map = L.map('map').setView([-2.855, 141.54], 13);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: 'Â© OpenStreetMap contributors'
        }).addTo(map);

        let routeData;
        let marker;
        let currentFeature = 0;

        fetch('synced_route.geojson')
            .then(res => res.json())
            .then(data => {
                routeData = data.features;
                let latlngs = routeData.map(f => [f.geometry.coordinates[1], f.geometry.coordinates[0]]);
                L.polyline(latlngs, { color: 'blue' }).addTo(map);
                marker = L.marker(latlngs[0]).addTo(map);
            });

        let player;
        function onYouTubeIframeAPIReady() {
            player = new YT.Player('ytplayer', {
                events: {
                    'onReady': onPlayerReady,
                    'onStateChange': onPlayerStateChange
                }
            });
        }

        function onPlayerReady(event) {
            setInterval(syncMarker, 1000);
        }

        function syncMarker() {
            if (player && routeData) {
                let time = Math.floor(player.getCurrentTime());
                let match = routeData.find(f => f.properties.timestamp >= time);
                if (match) {
                    marker.setLatLng([match.geometry.coordinates[1], match.geometry.coordinates[0]]);
                }
            }
        }

        function onPlayerStateChange(event) {
            if (event.data === YT.PlayerState.ENDED && player.getVideoUrl().includes("38JummjZeAs")) {
                player.loadVideoById("uSo2IoyOx10"); // Auto-switch to Part 2
            }
        }
    </script>
</body>
</html>
